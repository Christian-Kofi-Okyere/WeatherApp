<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png" />
    <link rel="icon" type="image/png" href="../assets/img/favicon.png" />
    <title>Argon Dashboard 2 by Creative Tim</title>
    
    <!-- Fonts and Icons -->
    <link
      rel="stylesheet"
      type="text/css"
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700"
    />
    <!-- Nucleo Icons -->
    <link type="text/css" href="{{ url_for('static', filename='CSS/nucleo-icons.css') }}" rel="stylesheet" />
    <link type="text/css" href="{{ url_for('static', filename='CSS/nucleo-svg.css') }}" rel="stylesheet" />
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
    <!-- Main CSS File -->
    <link id="pagestyle" type="text/css" href="{{ url_for('static', filename='css/argon-dashboard.css') }}" rel="stylesheet" />
    
    <!-- Custom Styles for a Colorful, Dark Design -->
    <style>
      /* Page Background with a Dark Gradient */
      body {
        background: linear-gradient(45deg, #1e1e2f, #3a3a52);
        color: #f8f9fa;
      }
      /* Force all cards to have a dark background with no border */
      .card {
        background-color: #343a40 !important;
        border: none;
        border-radius: 10px;
        margin-bottom: 20px;
      }
      /* Card body text color */
      .card .card-body {
        color: #f8f9fa;
      }
      /* Style for primary buttons with a colorful gradient */
      .btn-primary {
        background: linear-gradient(45deg, #ff6f61, #de4c4a);
        border: none;
      }
      /* Style the dropdown menu */
      .dropdown-menu {
        background: #343a40;
        border: none;
      }
      .dropdown-menu .form-control {
        background-color: #495057;
        border: 1px solid #6c757d;
        color: #f8f9fa;
      }
      .dropdown-menu label {
        color: #f8f9fa;
      }
      /* Secondary buttons */
      .btn-secondary {
        background-color: #6c757d;
        border: none;
      }
      /* Accent color for headings within cards */
      .accent {
        color: #ff6f61;
      }
    </style>
  </head>
  
  <body class="g-sidenav-show bg-gray-100">
    <div class="min-height-300 bg-dark position-absolute w-100"></div>
    <main class="main-content position-relative border-radius-lg">
      <div class="container-fluid py-4">
        <!-- Location Selector -->
        <div class="btn-group mx-4">
          <button id="dLabel" class="bg-dark btn btn-secondary btn-lg" type="button">
            {{ weather_data_string.name }}, {{ weather_data_string.country }}
          </button>
          <button
            type="button"
            class="bg-dark btn btn-secondary dropdown-toggle dropdown-toggle-split"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
          >
            <span class="sr-only"></span>
          </button>
          <form class="bg-gradient-primary dropdown-menu p-2" action="/" aria-labelledby="dLabel" method="post">
            <div class="form-group">
              <label for="city">City:</label>
              <input type="text" class="form-control" id="city" name="city" placeholder="Enter name of city" required />
            </div>
            <div class="form-group">
              <label for="state">State:</label>
              <input type="text" class="form-control" id="state" name="state" placeholder="Enter name of state" />
            </div>
            <div class="form-group">
              <label for="country">Country:</label>
              <input type="text" class="form-control" id="country" name="country" placeholder="Enter name of country" required />
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
          </form>
        </div>
        <!-- End of Selector -->
        
        <div class="row">
          <!-- Main Weather Card -->
          <div class="col-xl-8 col-sm-12 mb-xl-0 mb-4">
            <div class="card weather-card">
              <div class="card-body p-4">
                <!-- Header: Title and Last Updated Time -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h4 class="card-title mb-0">Current Weather</h4>
                  <small class="mb-0">Updated: {{ time }}</small>
                </div>
          
                <!-- Main Weather Details -->
                <div class="row align-items-center">
                  <!-- Weather Icon -->
                  <div class="col-md-3 text-center">
                    {% if weather_data_string.image %}
                      <img src="{{ weather_data_string.image }}" alt="Weather Icon" class="img-fluid" style="max-height: 80px;">
                    {% else %}
                      <i class="fa fa-sun-o fa-3x" aria-hidden="true"></i>
                    {% endif %}
                  </div>
                  <!-- Temperature -->
                  <div class="col-md-5 text-center">
                    <h1 class="display-3 font-weight-bold">{{ weather_data_numeric.temperature }}°C</h1>
                  </div>
                  <!-- Condition & Feels Like -->
                  <div class="col-md-4 text-center">
                    <p class="lead mb-0 text-uppercase" style="letter-spacing: 1px;">{{ weather_data_string.main }}</p>
                    <p class="mb-0">Feels Like: <strong>{{ weather_data_numeric.feels }}°C</strong></p>
                  </div>
                </div>
          
                <hr class="my-3">
          
                <!-- Weather Description and Minimum Temperature -->
                <div class="text-center mb-3">
                  <p class="mb-0">
                    <em>{{ weather_data_string.description | capitalize }}</em> with a low of <strong>{{ weather_data_numeric.temp_min }}°C</strong>
                  </p>
                </div>
          
                <!-- Additional Weather Metrics -->
                <div class="row text-center">
                  <div class="col">
                    <small class="text-uppercase">Wind</small>
                    <p class="font-weight-bold mb-0">{{ weather_data_numeric.wind }}</p>
                  </div>
                  <div class="col">
                    <small class="text-uppercase">Humidity</small>
                    <p class="font-weight-bold mb-0">{{ weather_data_numeric.humidity }}%</p>
                  </div>
                  <div class="col">
                    <small class="text-uppercase">Visibility</small>
                    <p class="font-weight-bold mb-0">{{ weather_data_numeric.visibility }} km</p>
                  </div>
                  <div class="col">
                    <small class="text-uppercase">Pressure</small>
                    <p class="font-weight-bold mb-0">{{ weather_data_numeric.pressure }} hPa</p>
                  </div>
                  <div class="col">
                    <small class="text-uppercase">Dew Point</small>
                    <p class="font-weight-bold mb-0">{{ weather_data_numeric.dew_point or "N/A" }}</p>
                  </div>
                </div>
              </div>
            </div>
          </div>          
          
        <!-- Sales Card -->
        <div class="col-xl-4 col-sm-12">
          <div class="card" style="height: 650px; position: relative;">
            <!-- Background Image Filling the Card -->
            <img 
              src="{{ url_for('static', filename='img/HILmr.png') }}" 
              alt="Sales Image" 
              style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; z-index: 1;"
            >
            
            <!-- Optional Overlay for Better Readability -->
            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.3); z-index: 2;"></div>
            
            <!-- Card Content Overlaid on the Image -->
            <div class="card-body p-3" style="position: relative; z-index: 3;">
              <div class="row">
                <div class="col-8">
                  <div class="numbers">
                    <!-- <p class="text-sm mb-0 text-uppercase font-weight-bold accent">Sales</p>
                    <h5 class="font-weight-bolder accent">$103,430</h5> -->
                  </div>
                </div>
                <div class="col-4 text-end">
                  <div class="icon icon-shape bg-gradient-warning shadow-warning text-center rounded-circle">
                    <i class="ni ni-cart text-lg opacity-10" aria-hidden="true"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      
      <!-- Additional Card Section -->
      <div class="container-fluid py-4">
        <div class="row">
          <!-- Today's Land Card -->
          <div class="col-xl-4 col-sm-12 mb-xl-0 mb-4">
            <div class="card" style="height: 200px;">
              <div class="card-body p-3">
                <div class="row">
                  <div class="col-8">
                    <div class="numbers">
                      <p class="text-sm mb-0 text-uppercase font-weight-bold accent">Today's Land</p>
                      <h5 class="font-weight-bolder accent">$53,000</h5>
                      <p class="mb-0">
                        <span class="text-success text-sm font-weight-bolder">+55%</span> since yesterday
                      </p>
                    </div>
                  </div>
                  <div class="col-4 text-end">
                    <div class="icon icon-shape bg-gradient-primary shadow-primary text-center rounded-circle">
                      <i class="ni ni-money-coins text-lg opacity-10" aria-hidden="true"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Today's Hide Card -->
          <div class="col-xl-2 col-sm-12 mb-xl-0 mb-4">
            <div class="card" style="height: 200px;">
              <div class="card-body p-3">
                <div class="row">
                  <div class="col-8">
                    <div class="numbers">
                      <p class="text-sm mb-0 text-uppercase font-weight-bold accent">Today's Hide</p>
                      <h5 class="font-weight-bolder accent">$53,000</h5>
                      <p class="mb-0">
                        <span class="text-success text-sm font-weight-bolder">+55%</span> since yesterday
                      </p>
                    </div>
                  </div>
                  <div class="col-4 text-end">
                    <div class="icon icon-shape bg-gradient-primary shadow-primary text-center rounded-circle">
                      <i class="ni ni-money-coins text-lg opacity-10" aria-hidden="true"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Today's End Card -->
          <div class="col-xl-2 col-sm-12 mb-xl-0 mb-4">
            <div class="card" style="height: 200px;">
              <div class="card-body p-3">
                <div class="row">
                  <div class="col-8">
                    <div class="numbers">
                      <p class="text-sm mb-0 text-uppercase font-weight-bold accent">Today's End</p>
                      <h5 class="font-weight-bolder accent">$53,000</h5>
                      <p class="mb-0">
                        <span class="text-success text-sm font-weight-bolder">+55%</span> since yesterday
                      </p>
                    </div>
                  </div>
                  <div class="col-4 text-end">
                    <div class="icon icon-shape bg-gradient-primary shadow-primary text-center rounded-circle">
                      <i class="ni ni-money-coins text-lg opacity-10" aria-hidden="true"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Today's Ping Card -->
          <div class="col-xl-2 col-sm-12 mb-xl-0 mb-4">
            <div class="card" style="height: 200px;">
              <div class="card-body p-3">
                <div class="row">
                  <div class="col-8">
                    <div class="numbers">
                      <p class="text-sm mb-0 text-uppercase font-weight-bold accent">Today's Ping</p>
                      <h5 class="font-weight-bolder accent">$53,000</h5>
                      <p class="mb-0">
                        <span class="text-success text-sm font-weight-bolder">+55%</span> since yesterday
                      </p>
                    </div>
                  </div>
                  <div class="col-4 text-end">
                    <div class="icon icon-shape bg-gradient-primary shadow-primary text-center rounded-circle">
                      <i class="ni ni-money-coins text-lg opacity-10" aria-hidden="true"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Sales Card -->
          <div class="col-xl-2 col-sm-12">
            <div class="card" style="height: 200px;">
              <div class="card-body p-3">
                <div class="row">
                  <div class="col-8">
                    <div class="numbers">
                      <p class="text-sm mb-0 text-uppercase font-weight-bold accent">Sales</p>
                      <h5 class="font-weight-bolder accent">$103,430</h5>
                      <p class="mb-0">
                        <span class="text-success text-sm font-weight-bolder">+5%</span> than last month
                      </p>
                    </div>
                  </div>
                  <div class="col-4 text-end">
                    <div class="icon icon-shape bg-gradient-warning shadow-warning text-center rounded-circle">
                      <i class="ni ni-cart text-lg opacity-10" aria-hidden="true"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div> <!-- End Additional Card Section -->
      
      <!-- Bottom Card Section -->
      <div class="container-fluid py-4">
        <div class="row">
          <div class="col-xl-12 col-sm-12 mb-xl-0 mb-4">
            <div class="card" style="height: 450px;">
              <div class="card-body p-3">
                <div class="row">
                  <div class="col-8">
                    <div class="numbers">
                      <p class="text-sm mb-0 text-uppercase font-weight-bold accent">Today's Money</p>
                      <h5 class="font-weight-bolder accent">$53,000</h5>
                      <p class="mb-0">
                        <span class="text-success text-sm font-weight-bolder">+55%</span> since yesterday
                      </p>
                    </div>
                  </div>
                  <div class="col-4 text-end">
                    <div class="icon icon-shape bg-gradient-primary shadow-primary text-center rounded-circle">
                      <i class="ni ni-money-coins text-lg opacity-10" aria-hidden="true"></i>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
     <!-- Gets User's Geolocation -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        function getLocation() {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(sendLocation, showError);
          } else {
            console.error("Geolocation is not supported by this browser.");
          }
        }
      
        function sendLocation(position) {
          const latitude = position.coords.latitude;
          const longitude = position.coords.longitude;
      
          // Send location data to Flask backend (ensure it completes before redirecting)
          fetch('/save_location', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ latitude, longitude })
          })
          .then(response => {
            if (response.redirected) {
              window.location.href = response.url; // Redirect only after backend processes data
            } else {
              return response.json();
            }
          })
          .catch(error => console.error("Error:", error));
        }
      
        function showError(error) {
          console.error("Geolocation error:", error.message);
        }
      
        // Call the function when the page loads
        getLocation();
      });
    </script> 
    <!-- Load jQuery, Popper.js, and Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.1/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- Github Buttons -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <!-- Control Center for Soft Dashboard -->
    <script src="{{ url_for('static', filename='js/argon-dashboard.min.js') }}"></script>
  </body>
</html>